<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë±öÂ∞èÂ±ãÊé¢Ê§úÈöä - Ë±öÂ∞èÂ±ã„Å´ÂÖ•„Çâ„Åö„Çì„Å∞Â≠êË±ö„ÇíÂæó„Åö</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #04384c 0%, #022838 50%, #011825 100%);
            color: #e8f4f8; 
            min-height: 100vh; 
            padding: 10px; 
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(0, 0, 0, 0.7); border-radius: 15px; }
        .header h1 { color: #FFD700; font-size: 2em; margin-bottom: 8px; }
        .subtitle { color: #DC143C; font-style: italic; }
        .connection-status, .player-name-display { position: fixed; top: 10px; padding: 8px 15px; border-radius: 15px; font-weight: bold; z-index: 100; font-size: 12px; }
        .connection-status { right: 10px; background: rgba(220, 20, 60, 0.9); color: white; }
        .connection-status.connected { background: rgba(34, 139, 34, 0.9); }
        .player-name-display { left: 10px; background: rgba(255, 215, 0, 0.2); border: 2px solid #FFD700; display: none; }
        .error-message { background: rgba(220, 20, 60, 0.9); color: white; padding: 12px; border-radius: 8px; margin: 10px 0; text-align: center; display: none; }
        .btn { background: linear-gradient(45deg, #04384c, #065a7a); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: bold; cursor: pointer; margin: 5px; width: 100%; }
        .btn:hover { background: linear-gradient(45deg, #065a7a, #0876a0); }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #87CEEB; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #04384c; border-radius: 5px; background: rgba(0, 0, 0, 0.7); color: #e8f4f8; font-size: 16px; }
        .control-section { background: rgba(0, 0, 0, 0.5); padding: 15px; border-radius: 10px; border: 2px solid rgba(135, 206, 235, 0.2); margin-bottom: 15px; }
        .control-section h3 { color: #87CEEB; margin-bottom: 15px; }
        #lobby, #room-info, #game-board, #victory-screen { display: none; }
        #lobby { display: block; }
        .room-id-display { background: rgba(255, 215, 0, 0.2); padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 15px; font-size: 1.5em; font-weight: bold; border: 2px solid rgba(255, 215, 0, 0.5); }
        .players-list { background: rgba(4, 56, 76, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .player-item { padding: 10px; margin: 6px 0; background: rgba(0, 0, 0, 0.5); border-radius: 5px; }
        .game-info { background: rgba(4, 56, 76, 0.5); padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .my-cards-section { background: rgba(4, 56, 76, 0.3); padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .my-cards-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
        .card { aspect-ratio: 3/4; border: 2px solid #04384c; border-radius: 8px; background: linear-gradient(135deg, #022838, #04384c); display: flex; align-items: center; justify-content: center; font-weight: bold; min-height: 60px; }
        .other-players-container { margin-bottom: 15px; }
        .other-player-box { background: rgba(0, 0, 0, 0.5); padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 2px solid rgba(135, 206, 235, 0.2); }
        .other-player-cards { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
        .other-card { aspect-ratio: 3/4; border: 2px solid #04384c; border-radius: 6px; background: linear-gradient(135deg, #011825, #04384c); cursor: pointer; min-height: 45px; }
        .victory-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.95); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .victory-content { background: linear-gradient(135deg, #04384c, #022838); padding: 30px; border-radius: 20px; text-align: center; border: 3px solid #FFD700; max-width: 400px; width: 100%; }
        .checkbox-group { margin-bottom: 15px; }
        .checkbox-group input { width: auto; margin-right: 10px; }
        .status-success { background: rgba(34, 139, 34, 0.9) !important; }
        .status-warning { background: rgba(255, 165, 0, 0.9) !important; }

        /* === ËøΩÂä†ÊîπÂñÑÊ©üËÉΩ„ÅÆCSS === */
        .toast {
            position: fixed;
            top: 70px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .toast.show { transform: translateX(0); }
        .toast.success { background: #28a745; }
        .toast.error { background: #dc3545; }
        .toast.warning { background: #ffc107; color: #000; }
        .toast.info { background: #17a2b8; }
        
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .spinner {
            width: 50px; height: 50px;
            border: 5px solid #333;
            border-top: 5px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1500;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #04384c, #022838);
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 2px solid #FFD700;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .modal-content h3 {
            color: #FFD700;
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
            display: none;
            border: 1px solid #FFD700;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .quick-join {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(40, 167, 69, 0.4);
            z-index: 100;
            display: none;
            transition: all 0.3s ease;
        }
        
        .quick-join:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(40, 167, 69, 0.6);
        }

        .game-room-id {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 215, 0, 0.9);
            color: #04384c;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 101;
            display: none;
        }
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            .toast {
                right: 10px;
                max-width: calc(100vw - 20px);
                top: 50px;
            }
            
            .quick-join {
                bottom: 80px;
                right: 15px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .game-room-id {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                display: block;
                text-align: center;
                margin-bottom: 10px;
            }
        }

        /* Êñ∞„Åó„ÅÑ„Éú„Çø„É≥„Çπ„Çø„Ç§„É´ */
        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #218838, #1ea085);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #c82333, #a71e2a);
        }
    </style>
</head>
<body>
    <div class="connection-status disconnected" id="connection-status">üî¥ Êú™Êé•Á∂ö</div>
    <div class="player-name-display" id="player-name-display">üë§ <span id="my-name"></span></div>
    <div class="game-room-id" id="game-room-id">üè† „É´„Éº„É†: <span id="game-room-id-text"></span></div>
    
    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
    </div>
    
    <!-- Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <h3 id="confirm-title">Á¢∫Ë™ç</h3>
            <p id="confirm-message">„Åì„ÅÆÊìç‰Ωú„ÇíÂÆüË°å„Åó„Åæ„Åô„ÅãÔºü</p>
            <div style="margin-top: 20px;">
                <button id="confirm-yes" class="btn btn-success" style="width: auto; margin: 5px;">„ÅØ„ÅÑ</button>
                <button id="confirm-no" class="btn btn-danger" style="width: auto; margin: 5px;">„ÅÑ„ÅÑ„Åà</button>
            </div>
        </div>
    </div>
    
    <!-- „ÇØ„Ç§„ÉÉ„ÇØÂèÇÂä†„Éú„Çø„É≥ -->
    <button class="quick-join" id="quick-join" title="„É©„É≥„ÉÄ„É†„É´„Éº„É†„Å´ÂèÇÂä†">üé≤</button>
    
    <!-- ÈÄ≤Êçó„Éê„Éº -->
    <div class="progress-bar" id="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>üê∑ Ë±öÂ∞èÂ±ãÊé¢Ê§úÈöä üê∑</h1>
            <p class="subtitle">Ë±öÂ∞èÂ±ã„Å´ÂÖ•„Çâ„Åö„Çì„Å∞Â≠êË±ö„ÇíÂæó„Åö</p>
        </div>

        <div id="error-message" class="error-message"></div>

        <!-- „É≠„Éì„ÉºÁîªÈù¢ -->
        <div id="lobby" class="lobby">
            <div class="control-section">
                <h3>Êñ∞„Åó„ÅÑ„É´„Éº„É†„Çí‰ΩúÊàê</h3>
                <div class="input-group">
                    <label for="player-name-create">„Éó„É¨„Ç§„É§„ÉºÂêç:</label>
                    <input type="text" id="player-name-create" placeholder="ÂêçÂâç„ÇíÂÖ•Âäõ">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="use-password">
                    <label for="use-password" style="display: inline;">„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åô„Çã</label>
                </div>
                <div class="input-group" id="password-group" style="display: none;">
                    <label for="room-password">„Éë„Çπ„ÉØ„Éº„Éâ:</label>
                    <input type="password" id="room-password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                </div>
                <button id="create-room" class="btn">„É´„Éº„É†„Çí‰ΩúÊàê (Ctrl+Enter)</button>
            </div>
            
            <div class="control-section">
                <h3>„É´„Éº„É†„Å´ÂèÇÂä†</h3>
                <div class="input-group">
                    <label for="player-name-join">„Éó„É¨„Ç§„É§„ÉºÂêç:</label>
                    <input type="text" id="player-name-join" placeholder="ÂêçÂâç„ÇíÂÖ•Âäõ">
                </div>
                <div class="input-group">
                    <label for="room-id-input">„É´„Éº„É†ID:</label>
                    <input type="text" id="room-id-input" placeholder="„É´„Éº„É†ID„ÇíÂÖ•Âäõ">
                </div>
                <div class="input-group" id="join-password-group" style="display: none;">
                    <label for="join-password">„Éë„Çπ„ÉØ„Éº„Éâ:</label>
                    <input type="password" id="join-password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                </div>
                <button id="join-room" class="btn">„É´„Éº„É†„Å´ÂèÇÂä†</button>
            </div>

            <div class="control-section">
                <h3>„Ç≤„Éº„É†‰∏≠„ÅÆ„É´„Éº„É†„Å´ÂÜçÂÖ•Â†¥</h3>
                <div class="input-group">
                    <label for="rejoin-player-name">„Éó„É¨„Ç§„É§„ÉºÂêç:</label>
                    <input type="text" id="rejoin-player-name" placeholder="ÂÖÉ„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ">
                </div>
                <div class="input-group">
                    <label for="rejoin-room-id">„É´„Éº„É†ID:</label>
                    <input type="text" id="rejoin-room-id" placeholder="„É´„Éº„É†ID„ÇíÂÖ•Âäõ">
                </div>
                <button id="rejoin-room" class="btn">„Ç≤„Éº„É†„Å´ÂÜçÂÖ•Â†¥</button>
            </div>

            <div class="control-section">
                <h3>Ë¶≥Êà¶„É¢„Éº„Éâ</h3>
                <div class="input-group">
                    <label for="spectator-name">Ë¶≥Êà¶ËÄÖÂêç:</label>
                    <input type="text" id="spectator-name" placeholder="ÂêçÂâç„ÇíÂÖ•Âäõ">
                </div>
                <div class="input-group">
                    <label for="spectate-room-id">„É´„Éº„É†ID:</label>
                    <input type="text" id="spectate-room-id" placeholder="„É´„Éº„É†ID„ÇíÂÖ•Âäõ">
                </div>
                <button id="spectate-room" class="btn">Ë¶≥Êà¶„Åô„Çã</button>
            </div>
        </div>

        <!-- „É´„Éº„É†ÊÉÖÂ†±ÁîªÈù¢ -->
        <div id="room-info" class="room-info">
            <div class="room-id-display">„É´„Éº„É†ID: <span id="room-id-display"></span></div>
            
            <div class="players-list">
                <h3>ÂèÇÂä†„Éó„É¨„Ç§„É§„Éº (<span id="player-count">0</span>/10)</h3>
                <div id="players-list"></div>
            </div>
            
            <div>
                <button id="start-game" class="btn btn-success" style="display: none;">„Ç≤„Éº„É†ÈñãÂßã (3‰∫∫‰ª•‰∏äÂøÖË¶Å)</button>
                <button id="leave-room" class="btn btn-danger">„É´„Éº„É†„ÇíÈÄÄÂá∫</button>
                <button id="temp-leave-room" class="btn" style="display: none;">‰∏ÄÊôÇÈÄÄÂá∫</button>
                <button id="cancel-temp-leave" class="btn" style="display: none;">„Ç≠„É£„É≥„Çª„É´</button>
            </div>

            <div class="temp-leave-section" id="temp-leave-section" style="display: none;">
                <h4>‚ö†Ô∏è „Ç≤„Éº„É†‰∏≠„ÅÆ‰∏ÄÊôÇÈÄÄÂá∫</h4>
                <p>„Ç≤„Éº„É†‰∏≠„Åß„Åô„Åå„ÄÅ‰∏ÄÊôÇÁöÑ„Å´ÈÄÄÂá∫„Åß„Åç„Åæ„Åô„ÄÇ</p>
            </div>
        </div>

        <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
        <div id="game-board" class="game-board">
            <div class="game-info">
                <h3>„Ç≤„Éº„É†ÊÉÖÂ†±</h3>
                <p>„É©„Ç¶„É≥„Éâ: <span id="current-round">1</span>/4</p>
                <p>Ë≤°ÂÆù: <span id="treasure-found">0</span>/<span id="treasure-goal">7</span></p>
                <p>ÁΩ†: <span id="trap-triggered">0</span>/<span id="trap-goal">2</span></p>
                <p>Èçµ‰øùÊåÅËÄÖ: <span id="key-holder-name">‰∏çÊòé</span></p>
                <p id="turn-message">ÂæÖÊ©ü‰∏≠...</p>
            </div>

            <div class="my-cards-section">
                <h3>„ÅÇ„Å™„Åü„ÅÆ„Ç´„Éº„Éâ</h3>
                <p>Â≠êË±ö <span id="my-treasure">0</span> / ÁΩ† <span id="my-trap">0</span> / Á©∫„Åç <span id="my-empty">0</span></p>
                <div id="my-cards-grid" class="my-cards-grid"></div>
            </div>

            <div>
                <h3>‰ªñ„ÅÆ„Éó„É¨„Ç§„É§„Éº</h3>
                <div id="other-players-container" class="other-players-container"></div>
            </div>

            <button id="game-leave-room" class="btn btn-danger">‰∏ÄÊôÇÈÄÄÂá∫</button>
        </div>

        <!-- ÂãùÂà©ÁîªÈù¢ -->
        <div id="victory-screen" class="victory-screen">
            <div class="victory-content">
                <h2 id="victory-title"></h2>
                <p id="victory-message"></p>
                <div id="winners-list"></div>
                <button id="return-to-lobby-victory" class="btn btn-success">„É≠„Éì„Éº„Å´Êàª„Çã</button>
            </div>
        </div>
    </div>

    <!-- ÂøÖË¶Å„Å™Èö†„ÅóË¶ÅÁ¥† -->
    <div id="treasure-icons" style="display: none;"></div>
    <div id="trap-icons" style="display: none;"></div>
    <div id="role-reveal" style="display: none;">
        <div id="player-role"></div>
        <p id="role-description"></p>
        <img id="role-image" src="" alt="">
    </div>

    <!-- Socket.io CDN -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    
    <script>
        console.log('EnhancedÁµ±ÂêàJavaScriptÈñãÂßã');

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        const safeGetElement = (id) => document.getElementById(id);
        const safeSetText = (id, text) => {
            const el = safeGetElement(id);
            if (el) el.textContent = text;
        };
        const safeSetHTML = (id, html) => {
            const el = safeGetElement(id);
            if (el) el.innerHTML = html;
        };
        const safeAddEventListener = (id, event, handler) => {
            const element = safeGetElement(id);
            if (element) {
                element.addEventListener(event, handler);
                console.log(`‚úÖ ${id} „Å´„Ç§„Éô„É≥„ÉàËøΩÂä†ÊàêÂäü`);
            } else {
                console.warn(`‚ö†Ô∏è Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: #${id}`);
            }
        };

        // Enhanced UIManager „ÇØ„É©„Çπ
        class UIManager {
            // Êñ∞Ê©üËÉΩÔºö„Éà„Éº„Çπ„ÉàÈÄöÁü•
            static showToast(message, type = 'info', duration = 3000) {
                // Êó¢Â≠ò„ÅÆ„Éà„Éº„Çπ„Éà„ÇíÂâäÈô§
                document.querySelectorAll('.toast').forEach(toast => toast.remove());
                
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                setTimeout(() => toast.classList.add('show'), 100);
                
                // Ëá™ÂãïÂâäÈô§
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
            
            // Êñ∞Ê©üËÉΩÔºö„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            static showLoading(show = true) {
                const overlay = safeGetElement('loading-overlay');
                if (overlay) {
                    overlay.style.display = show ? 'flex' : 'none';
                }
            }
            
            // Êñ∞Ê©üËÉΩÔºöÁ¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
            static showConfirm(title, message) {
                return new Promise((resolve) => {
                    const modal = safeGetElement('confirm-modal');
                    const titleEl = safeGetElement('confirm-title');
                    const messageEl = safeGetElement('confirm-message');
                    const yesBtn = safeGetElement('confirm-yes');
                    const noBtn = safeGetElement('confirm-no');
                    
                    if (!modal) {
                        resolve(false);
                        return;
                    }
                    
                    if (titleEl) titleEl.textContent = title;
                    if (messageEl) messageEl.textContent = message;
                    
                    modal.style.display = 'flex';
                    
                    const cleanup = () => {
                        modal.style.display = 'none';
                        yesBtn?.removeEventListener('click', handleYes);
                        noBtn?.removeEventListener('click', handleNo);
                    };
                    
                    const handleYes = () => {
                        cleanup();
                        resolve(true);
                    };
                    
                    const handleNo = () => {
                        cleanup();
                        resolve(false);
                    };
                    
                    yesBtn?.addEventListener('click', handleYes);
                    noBtn?.addEventListener('click', handleNo);

                    // Escape„Ç≠„Éº„Åß„Ç≠„É£„É≥„Çª„É´
                    const handleEscape = (e) => {
                        if (e.key === 'Escape') {
                            cleanup();
                            resolve(false);
                            document.removeEventListener('keydown', handleEscape);
                        }
                    };
                    document.addEventListener('keydown', handleEscape);
                });
            }
            
            // Êñ∞Ê©üËÉΩÔºöÈÄ≤Êçó„Éê„Éº
            static showProgress(percent) {
                const progressBar = safeGetElement('progress-bar');
                const progressFill = safeGetElement('progress-fill');
                
                if (progressBar && progressFill) {
                    progressBar.style.display = 'block';
                    progressFill.style.width = `${Math.max(0, Math.min(100, percent))}%`;
                    
                    if (percent >= 100) {
                        setTimeout(() => {
                            progressBar.style.display = 'none';
                        }, 1500);
                    }
                }
            }

            // ÊîπÂñÑ„Åï„Çå„Åü„Ç®„É©„ÉºË°®Á§∫
            static showError(message, type = 'error') {
                const errorEl = safeGetElement('error-message');
                if (!errorEl) return;
                
                errorEl.textContent = message;
                errorEl.className = 'error-message';
                
                if (type === 'success') {
                    errorEl.classList.add('status-success');
                } else if (type === 'warning') {
                    errorEl.classList.add('status-warning');
                }
                
                errorEl.style.display = 'block';
                
                setTimeout(() => {
                    errorEl.style.display = 'none';
                }, type === 'success' ? 3000 : 5000);

                // „Éà„Éº„Çπ„ÉàÈÄöÁü•„ÇÇË°®Á§∫
                this.showToast(message, type);
            }

            static showConnectionStatus(status) {
                const statusEl = safeGetElement('connection-status');
                if (!statusEl) return;
                
                if (status === 'connected') {
                    statusEl.textContent = 'üü¢ Êé•Á∂öÊ∏à„Åø';
                    statusEl.className = 'connection-status connected';
                } else {
                    statusEl.textContent = 'üî¥ ÂàáÊñ≠';
                    statusEl.className = 'connection-status disconnected';
                }
            }

            static showPlayerName(name) {
                const displayEl = safeGetElement('player-name-display');
                const nameEl = safeGetElement('my-name');
                
                if (displayEl && nameEl) {
                    displayEl.style.display = 'block';
                    nameEl.textContent = name;
                }
            }

            static showGameRoomId(roomId) {
                const gameRoomIdEl = safeGetElement('game-room-id');
                const gameRoomIdTextEl = safeGetElement('game-room-id-text');
                
                if (gameRoomIdEl && gameRoomIdTextEl) {
                    if (roomId) {
                        gameRoomIdTextEl.textContent = roomId;
                        gameRoomIdEl.style.display = 'block';
                    } else {
                        gameRoomIdEl.style.display = 'none';
                    }
                }
            }

            static showScreen(screenName) {
                const screens = ['lobby', 'room-info', 'game-board', 'victory-screen'];
                
                screens.forEach(screen => {
                    const element = safeGetElement(screen);
                    if (element) {
                        element.style.display = 'none';
                    }
                });
                
                if (screenName) {
                    const screen = safeGetElement(screenName);
                    if (screen) {
                        screen.style.display = 'block';
                    }
                }

                // „Ç≤„Éº„É†ÁîªÈù¢„ÅÆÂ†¥Âêà„ÅØ„É´„Éº„É†ID„ÇíË°®Á§∫
                if (screenName === 'game-board' && window.game?.roomId) {
                    this.showGameRoomId(window.game.roomId);
                } else {
                    this.showGameRoomId(null);
                }
            }

            static updatePlayersList(players, hostId) {
                const container = safeGetElement('players-list');
                const countEl = safeGetElement('player-count');
                
                if (!container || !countEl) return;
                
                const count = players.filter(p => p.connected).length;
                countEl.textContent = count;
                
                container.innerHTML = '';
                players.forEach((player) => {
                    const div = document.createElement('div');
                    div.className = 'player-item';
                    if (player.id === hostId) {
                        div.classList.add('host');
                    }
                    
                    const status = player.connected ? 'üü¢' : 'üî¥';
                    const disconnectedText = player.connected ? '' : ' (ÂàáÊñ≠‰∏≠)';
                    div.textContent = `${status} ${player.name}${disconnectedText}`;
                    
                    if (!player.connected) {
                        div.style.opacity = '0.6';
                        div.style.fontStyle = 'italic';
                    }
                    
                    container.appendChild(div);
                });
            }
        }

        // SocketClient „ÇØ„É©„Çπ
        class SocketClient {
            constructor(game) {
                this.game = game;
                this.socket = null;
                this.initializeSocket();
            }

            initializeSocket() {
                try {
                    this.socket = io({
                        transports: ['websocket', 'polling'],
                        timeout: 5000
                    });
                    
                    this.setup
